_target_: project.tasks.unlearning_enpo.UnlearningENPO
_recursive_: false

name: unlearning-enpo

defaults:
  - /text_encoder@text_encoder: qwen3-embedding-4b
  - /embedding_prediction_model@embedding_prediction_model: transformer
  - /data@unlearning_data: rwku-positive-sm

training_module:
  training_warmup_steps: 2000
  training_lr: 0.0001
  training_weight_decay: 0.0
  unlearning_lr: 0.0003
  unlearning_weight_decay: 0.0
  pretrained_model_hook_layer: 29
  clip_grad_norm: 1.0
  beta: 1.0  # eNPO loss parameter
  l1_weight: 1.0  # Weight for L1 (eNPO loss)
  l2_weight: 0.1  # Weight for L2 (KL divergence loss for non-forgetting)

num_other_targets: 3

first_stage_steps: 2000

# Optional checkpoint paths (set to null if not needed)
model_checkpoint_path: null
embedding_model_checkpoint_path: null
reference_model_path: null
reference_embedding_model_path: null

stages:
  - type: "training"
    steps: ${task.first_stage_steps}
  - type: "unlearning"
    threshold: 0.9  # Optional, kept for backward compatibility
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.8
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.75
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.7
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.65
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.6
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.5
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.4
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.3
    steps: 1000
  - type: "training"
    steps: 1000
  - type: "unlearning"
    threshold: 0.2
    steps: 1000
